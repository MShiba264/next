version: '3'
services:
  php:
    build: ./${PHP_VERSION}
    links:
      - db
      - memcached
    restart: always
  db:
      build: ./${DB_SERVER_TYPE}
      #        platform: linux/amd64
      ports:
        - '${INTERFACE}:3306:3306'
      environment:
        MYSQL_DATABASE: ${MYSQL_DATABASE}
        MYSQL_USER: ${MYSQL_USER}
        MYSQL_PASSWORD: ${MYSQL_PASSWORD}
        MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      command: mysqld --sql-mode=""
      restart: always
  nextjs:
    build: ./
  nginx:
    build: ./nginx
    ports:
      - 80:80
  memcached:
    image: memcached:1.6.12-alpine
    ports:
      - '${INTERFACE}:11211:11211'
    restart: always
#  adminer:
#      image: dockette/adminer:full
#      links:
#        - db:db
#      ports:
#        - '${INTERFACE}:8080:80'
#      environment:
#        UPLOAD: 1024M # upload_max_filesize, post_max_size
#      networks:
#        - bitrix
